<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="lib/pure.min.css" />
    <title>Document</title>

    <script type="module" src="components/exercise-viewer.js"></script>
    <script type="module" src="components/exercises/addsub-exercise.js"></script>
    <script type="module" src="components/partial/success-mark.js"></script>

    <style>
      html, body {
        height: 100%; width: 100%; background-color: #2c2c54; color: white;
      }
    </style>
  </head>

  <body>
    <x-exercise-view>
      <x-addsub-exercise></x-addsub-exercise>
    </x-exercise-view>

    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        const params = new URLSearchParams(location.search);
        const lessonId = params.get('lessonId');
        if (!lessonId) return;

        const r = await fetch(`/lesson/${lessonId}`);
        if (!r.ok) { console.error('Nie można pobrać lekcji', r.status); return; }
        const data = await r.json();
        const exercises = data.exercises || [];
        if (!exercises.length) return;

        const view = document.querySelector('x-exercise-view');
        const addSub = document.querySelector('x-addsub-exercise');

        view && view.setAttribute('progress-step', String(100 / exercises.length));

        let idx = 0;
        addSub.setAttribute('exercise-id', String(exercises[idx].id));

        view.addEventListener('next-exercise', () => {
          idx++;
          if (idx >= exercises.length) {
            console.log('Koniec lekcji'); // do zmiany kiedys
            return;
          }
          addSub.setAttribute('exercise-id', String(exercises[idx].id));
        });
      });
    </script>

  </body>
</html>